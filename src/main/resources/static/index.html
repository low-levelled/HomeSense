<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HomeSense</title>
  <style>
    body {
      font-family: sans-serif;
    }
    #room-list li {
      margin: 8px 0;
      cursor: pointer;
    }
    .hover-box {
      position: absolute;
      display: none;
      background: #fff;
      border: 1px solid #aaa;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      pointer-events: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <header style="background-color: #1e1e2f; padding: 1rem; color: white; display: flex; justify-content: space-between; align-items: center;">
    <h1 style="margin: 0;">üè† HomeSense</h1>
    <nav>
      <a href="#" style="margin-left: 2rem; color: white; text-decoration: none;">Dashboard</a>
      <a href="#" style="margin-left: 2rem; color: white; text-decoration: none;">Sensors</a>
      <a href="#" style="margin-left: 2rem; color: white; text-decoration: none;">Rooms</a>
    </nav>
  </header>

  <div style="text-align: center;">
    <h2>Live Backyard Stream</h2>
    <img id="pi-stream" src="http://192.168.0.74:8080/?action=stream" alt="Raspberry Pi Live Stream" style="width: 640px; border: 4px solid #333; border-radius: 12px;" />
  </div>

  <div id="room-list" style="padding: 1rem;"></div>

  <h1>üè† HomeSense Floorplan</h1>

  <!-- üîÅ SVG placeholder -->
  <svg id="floorplan" width="500" height="300" style="border:1px solid #ccc;"></svg>

  <!-- ‚ÑπÔ∏è Room popup area -->
  <div id="popup" style="display:none; margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #fff; width: 300px;">
    <strong id="roomName"></strong><br/>
    <em>[Data will appear here]</em>
  </div>

  <!-- üîß JavaScript for dynamic room rendering -->
  <script>
    async function fetchRooms() {
      try {
        const response = await fetch('/rooms');
        const rooms = await response.json();

        const roomList = document.getElementById('room-list');
        const svg = document.getElementById('floorplan');

        roomList.innerHTML = "";
        svg.innerHTML = "";

        const colors = ["#f0f0f0", "#fef3bd", "#d0f4de", "#cce5ff", "#ffe6e6"];
        const positions = [
          { x: 10, y: 10 },
          { x: 170, y: 10 },
          { x: 10, y: 140 },
          { x: 170, y: 140 },
          { x: 330, y: 10 }
        ];

        rooms.forEach((room, index) => {
          const pos = positions[index % positions.length];

          const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
          rect.setAttribute("x", pos.x);
          rect.setAttribute("y", pos.y);
          rect.setAttribute("width", 150);
          rect.setAttribute("height", 120);
          rect.setAttribute("fill", colors[index % colors.length]);
          rect.setAttribute("stroke", "#999");
          rect.setAttribute("onclick", `showRoom('${room.name}')`);
          svg.appendChild(rect);

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", pos.x + 10);
          text.setAttribute("y", pos.y + 20);
          text.setAttribute("fill", "black");
          text.textContent = room.name;
          svg.appendChild(text);

          // Optional: room list for debugging
          const div = document.createElement('div');
          div.textContent = `üõãÔ∏è Room ${room.id}: ${room.name}`;
          div.style.marginBottom = "1rem";
          div.style.fontSize = "1.2rem";
          roomList.appendChild(div);
        });

      } catch (error) {
        console.error("Failed to load rooms:", error);
      }
    }

    function showRoom(name) {
      document.getElementById("roomName").textContent = name;
      document.getElementById("popup").style.display = "block";
    }

    fetchRooms();
  </script>
</body>
</html>